Physor 2012
==============================

.. container:: main-title

    INTERPOLATIONS OF NUCLIDE-SPECIFIC SCATTERING KERNELS GENERATED WITH SERPENT

.. container:: main-names


    April 17th, 2012, Physor, Knoxville, TN

    Anthony Scopatz - The University of Chicago

    Erich Schneider - The University of Texas at Austin

    scopatz@flash.uchicago.edu


Goals
==============================
**Goal 1:** 

    Find the neutron scattering kernel [barns]

.. container:: align-center

    .. math::

        \sigma_{s,g\to h,i}

    for all incident and exiting energy groups and species:

.. container:: align-center

    .. math::

        g,h \in G, \, i \in I


Goals
==============================
**Goal 1:** 

    Find the neutron scattering kernel [barns]

.. container:: align-center

    .. math::

        \sigma_{s,g\to h,i}

    for all incident and exiting energy groups and species:

.. container:: align-center

    .. math::

        g,h \in G, \, i \in I

**Goal 2:** 

    Show that we may interpolate between related kernels.


Motivation
==============================
- Multigroup solvers that employ a perturbation-based approach to generate group 
  constants from a small number of pre-computed cases require nuclide specific 
  scattering cross sections.

Motivation
==============================
- Multigroup solvers that employ a perturbation-based approach to generate group 
  constants from a small number of pre-computed cases require nuclide specific 
  scattering cross sections.

* If we may interpolate between kernels, then the method by which 
  we obtain the scattering kernel (typically Monte Carlo) may be performed 
  less often. 

Motivation
==============================
- Multigroup solvers that employ a perturbation-based approach to generate group 
  constants from a small number of pre-computed cases require nuclide specific 
  scattering cross sections.

* If we may interpolate between kernels, then the method by which 
  we obtain the scattering kernel (typically Monte Carlo) may be performed 
  less often. 

- Major application for this are in the fuel cycle.


Context
===============================
We have a perturbation-based multigroup solver in the Bright fuel cycle code [1]. 
This takes pre-computed libraries generated by a utility called Char [2]. 

These libraries are comprised of self-shielded, intragroup flux-weighted 
microscopic neutron cross sections for each nuclide for a suite of reactor states.

.. container:: gray-and-small

    1. A. Scopatz. "Bright v0.6." Technical report, The University of Texas at Austin, 
    Austin, TX, USA (2011). URL http://bright-dev.github.com/.

    2. A. Scopatz, 2011. "A Generalized Physics-Based Model for Reactor and Fuel Cycle 
    System Simulation," [PhD] dissertation, The University of Texas at Austin. 

Obtaining the Kernel
===============================
Out of the box, MCNPX v2.6+ [3] may calculate:

.. math:: \sigma_{s,g,i}

Obtaining the Kernel
===============================
Out of the box, MCNPX v2.6+ [3] may calculate:

.. math:: \sigma_{s,g,i}

Moreover, Serpent v1.7 [4] may calculate:

.. math:: \sigma_{s,g,i}, \, \sigma_{s,g\to h}

Obtaining the Kernel
===============================
Out of the box, MCNPX v2.6+ [3] may calculate:

.. math:: \sigma_{s,g,i}

Moreover, Serpent v1.7 [4] may calculate:

.. math:: \sigma_{s,g,i}, \, \sigma_{s,g\to h}

However, neither compute 

.. math:: \sigma_{s,g\to h,i}

.. container:: gray-and-small

    [3] D. B. Pelowitz. "MCNPX USERâ€™S'S MANUAL Version 2.6.0 - LA-CP-07-1473." Technical
    report, Los Alamos National Laboratory (2008).


    [4] J. Lepp. "PG2 / Serpent a Continuous-energy Monte Carlo Reactor Physics Burnup
    Calculation Code." Technical report (2011).


Obtaining the Kernel
===============================
* Since source code modifications were needed, Serpent was the easier choice as
  homogenized material scattering kernel were already tallied. 

Obtaining the Kernel
===============================
* Since source code modifications were needed, Serpent was the easier choice as
  homogenized material scattering kernel were already tallied. 

- In specific, Serpent returns the group transfer probabilities P [unitless]:

.. math:: \sum_h^G P_{g\to h} = \mathbf{\vec{1}}

.. math:: P_{g\to h} = \frac{\sigma_{s,g\to h}}{\sigma_{s,g}}



Obtaining the Kernel
===============================
The scattering cross section of a material is the weighted sum of the cross sections
of its constituent species,

.. math:: \sigma_{s,g\to h} = \sum_i^I \frac{N_i}{N} \cdot \sigma_{s,g\to h,i}

where N [atoms-i/cm3] is the number density.  Therefore:

.. math:: P_{g\to h} = \frac{\sum_i^I \frac{N_i}{N} \cdot \sigma_{s,g\to h,i}}{\sigma_{s,g}} = \sum_i^I \frac{N_i}{N} \cdot P_{g\to h,i}


Obtaining the Kernel
===============================
* To get around the summation in the above equations, a ``gtpmat`` option was added to Serpent::

    set gtpmat <material label>

Obtaining the Kernel
===============================
* To get around the summation in the above equations, a ``gtpmat`` option was added to Serpent::

    set gtpmat <material label>

- This acts as a filter for the reporting, but not the physics, of scattering.  
  Any species that are contained in a filter material will be present in the 
  group transfer probability.  All other species are discarded.


Obtaining the Kernel
===============================
* If only a single species is in the filter material, then the per-nuclide group
  transfer probability is obtained.

Obtaining the Kernel
===============================
* If only a single species is in the filter material, then the per-nuclide group
  transfer probability is obtained.

- Thus the group-to-group scattering cross section may be calculated from:

.. math:: \sigma_{s,g\to h,i} = \sigma_{s,g,i} \cdot P_{g\to h,i}

Obtaining the Kernel
===============================
* If only a single species is in the filter material, then the per-nuclide group
  transfer probability is obtained.

- Thus the group-to-group scattering cross section may be calculated from:

.. math:: \sigma_{s,g\to h,i} = \sigma_{s,g,i} \cdot P_{g\to h,i}

* Here the scattering group constant is determined from Serpent using normal 
  detector tallies.

Obtaining the Kernel
===============================
- Running a whole suite of single species filters will generate the data Char needs
  to pass on to Bright.

Obtaining the Kernel
===============================
- Running a whole suite of single species filters will generate the data Char needs
  to pass on to Bright.

* Previous studies [2] have tested that per-nuclide multigroup scattering cross sections
  may be interpolated.  However, such validation was never performed for kernel interpolation.


Interpolation Experiment
===============================
To test kernel interpolation, first take a lattice of light-water reactor (LWR) fuel pins 
(as described in [5]) and modify the fuel radius by +/-10%.

.. figure:: lattice.eps
    :align: center
    :scale: 90%

.. container:: gray-and-small

    [5] M. Takano. "Burnup Credit Criticality Benchmark - Result of Phase 1A -
    NEA/NSC/DOC(93)22." Technical Report January, Nuclear Energy Agency (1994).

Interpolation Experiment
===============================
For every species, generate the scattering kernel for the +10% case (``+`` superscript)
and the -10% case (``-``) for a 19 energy group structure.

Interpolation Experiment
===============================
For every species, generate the scattering kernel for the +10% case (``+`` superscript)
and the -10% case (``-``) for a 19 energy group structure. 

Next, perform a linear interpolation (``*``) based on the 
fuel radius r [cm] to obtain scattering kernels at radii internal to the bounds:

.. math:: 

    \sigma_{s,g\to h,i}^{*} = \left(\sigma_{s,g\to h,i}^{+} - \sigma_{s,g\to h,i}^{-}\right) 
                              \cdot \left(\frac{r^{*} - r^{-}}{r^{+} - r^{-}}\right)
                              + \sigma_{s,g\to h,i}^{-}

Interpolation Experiment
===============================
For every species, generate the scattering kernel for the +10% case (``+`` superscript)
and the -10% case (``-``) for a 19 energy group structure.

Next, perform a linear interpolation (``*``) based on the 
fuel radius r [cm] to obtain scattering kernels at radii internal to the bounds:

.. math:: 

    \sigma_{s,g\to h,i}^{*} = \left(\sigma_{s,g\to h,i}^{+} - \sigma_{s,g\to h,i}^{-}\right) 
                              \cdot \left(\frac{r^{*} - r^{-}}{r^{+} - r^{-}}\right)
                              + \sigma_{s,g\to h,i}^{-}

-5%, +5%, and the benchmark fuel radius cases were run.

Interpolation Tests
===============================
For every nuclide and incident and exiting energy groups, the following 
validation tests between the interpolation result and the "true" value (no superscript) 
- as calculated from additional Serpent runs - were performed.

Interpolation Tests
===============================
For every nuclide and incident and exiting energy groups, the following 
validation tests between the interpolation result and the "true" value (no superscript) 
- as calculated from additional Serpent runs - were performed.

* Small relative error:

.. math::

    \epsilon = \frac{\sigma_{s,g\to h,i}^{*}}{\sigma_{s,g\to h,i}} - 1 \ll 1

Interpolation Tests
===============================
For every nuclide and incident and exiting energy groups, the following 
validation tests between the interpolation result and the "true" value (no superscript) 
- as calculated from additional Serpent runs - were performed.

* Small relative error:

.. math::

    \epsilon = \frac{\sigma_{s,g\to h,i}^{*}}{\sigma_{s,g\to h,i}} - 1 \ll 1

- Kendall's tau near unity [unitless]:

.. math::

    \tau\left(\widetilde{\sigma}_{s,g\to h,i}^{*}, \widetilde{\sigma}_{s,g\to h,i}\right) \approx 1

Interpolation Tests
===============================
* Large absorption-to-scattering cross section ratio [unitless]:

.. math::

    1 \ll R_{a/s,g,i} = \frac{\sigma_{a,g,i}}{\sigma_{s,g,i}}

Interpolation Tests
===============================
* Large absorption-to-scattering cross section ratio [unitless]:

.. math::

    1 \ll R_{a/s,g,i} = \frac{\sigma_{a,g,i}}{\sigma_{s,g,i}}

* Or small group transfer probability:

.. math::

    P_{g\to h,i} < 0.5

Interpolation Tests
===============================
* Large absorption-to-scattering cross section ratio [unitless]:

.. math::

    1 \ll R_{a/s,g,i} = \frac{\sigma_{a,g,i}}{\sigma_{s,g,i}}


* Or small group transfer probability:

.. math::

    P_{g\to h,i} < 0.5

If the above relations hold, then the error induced by the interpolation is small enough
to not be of concern for a perturbation-based multigroup reactor model.

Results: -5% Benchmark Fuel Radius
=======================================
=========== ======= ====== ==== ==== ======= ====== ======
**nuclide** epsilon tau    g    h    sigma   P      R
H3          0.158   0.965  19   19   0.360   0.103  0.000
HE4         0.130   0.947  13   13   0.144   0.189  0.000
PU242       0.099   1.000  9    9    113.1   1.000  0.401
PU240       0.069   1.000  16   16   1151.0  1.000  11.95
ZR93        0.061   1.000  7    7    34.61   1.000  0.342
U236        0.055   1.000  9    9    44.08   1.000  0.696
PD107       0.054   1.000  7    7    8.789   1.000  2.036
=========== ======= ====== ==== ==== ======= ====== ======

.. container:: gray-and-small

    All results indexed by incident and exiting energy and sorted by max(abs(epsilon)).


Results: +0% Benchmark Fuel Radius
=======================================
=========== ======= ====== ==== ==== ======= ====== ======
**nuclide** epsilon tau    g    h    sigma   P      R
HE4         0.126   0.954  11   10   0.331   0.435  0.000
H3          0.083   0.970  11   10   0.619   0.372  0.000
U235        0.066   0.985  18   19   3.627   0.235  29.23
PD107       0.060   1.000  9    9    40.96   1.000  2.575
CM244       0.056   1.000  8    8    24.57   1.000  0.891
PU242       -0.043  1.000  9    9    129.0   1.000  0.403
U238        0.042   0.990  18   19   2.231   0.236  0.199
=========== ======= ====== ==== ==== ======= ====== ======

.. container:: gray-and-small

    All results indexed by incident and exiting energy and sorted by max(abs(epsilon)).


Results: +5% Benchmark Fuel Radius
=======================================
=========== ======= ====== ==== ==== ======= ====== ======
**nuclide** epsilon tau    g    h    sigma   P      R
HE4         -0.115  0.963  16   16   0.409   0.537  0.000
H3          -0.113  0.975  19   19   1.184   0.336  0.000
U235        -0.094  0.976  19   19   12.22   0.791  94.32
PU242       0.090   1.000  7    7    16.25   1.000  0.463
U236        -0.080  0.999  8    8    47.23   1.000  0.691
PU240       -0.054  1.000  9    9    76.04   1.000  1.482
U238        0.046   0.989  19   19   6.467   0.684  0.573
=========== ======= ====== ==== ==== ======= ====== ======

.. container:: gray-and-small

    All results indexed by incident and exiting energy and sorted by max(abs(epsilon)).


Results Summary
=======================================
* For 2,689 of 2,929 non-zero scattering kernel entries, 

.. math:: |\epsilon| < 0.02

Results Summary
=======================================
* For 2,689 of 2,929 non-zero scattering kernel entries, 

.. math:: |\epsilon| < 0.02

* This is true for H1 and O16 at thermal energies where
  fuel-to-moderator ratio changes have a large effect.

Results Summary
=======================================
* For 2,689 of 2,929 non-zero scattering kernel entries, 

.. math:: |\epsilon| < 0.02

* This is true for H1 and O16 at thermal energies where
  fuel-to-moderator ratio changes have a large effect.

- Kendall's tau is always greater than 0.94.  This implies that group-to-group
  scattering cross sections with high relative error are isolated and that the
  majority of the kernel matches.

Results Summary
=======================================
* Some species with high error and low tau have high absorption-to-scattering ratios.
  For example, U235 has an R which is over 94.   In such cases, scattering is a
  rare event where high error does not adversely affect criticality calculations
  in downstream applications.

Results Summary
=======================================
* Some species with high error and low tau have high absorption-to-scattering ratios.
  For example, U235 has an R which is over 94.   In such cases, scattering is a
  rare event where high error does not adversely affect criticality calculations
  in downstream applications.

- Lastly, for species with high error, low tau, and low R, the probability 
  of transferring from group g to group h is less than 50%.  This implies that 
  some other h for this g dominates the scatter events. 

Conclusions
====================================
* Nuclide specific scattering kernels may be obtained from Serpent with minor
  alterations to the source code and some simple post-processing.

Conclusions
====================================
* Nuclide specific scattering kernels may be obtained from Serpent with minor
  alterations to the source code and some simple post-processing.

- Cross sections generated in this way may be interpolated to within sufficient 
  error for perturbation-based multigroup burnup criticality solvers.

Conclusions
====================================
* Nuclide specific scattering kernels may be obtained from Serpent with minor
  alterations to the source code and some simple post-processing.

- Cross sections generated in this way may be interpolated to within sufficient 
  error for perturbation-based multigroup burnup criticality solvers.

* Thanks to Jaakko Leppanen for his guidance on Serpent's architecture.


Future Work
====================================
* Vary the perturbation size.

Future Work
====================================
* Vary the perturbation size.

- Investigate non-linear interpolation schemes.

Future Work
====================================
* Vary the perturbation size.

- Investigate non-linear interpolation schemes.

* Investigate methods to simultaneously compute the scattering kernel for many species.


Questions
===============================
.. image:: qm.jpg
    :scale: 50%

.. container:: gray-and-small

    Image source: http://www.fotopedia.com/items/flickr-2200500024
